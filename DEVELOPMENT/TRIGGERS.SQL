CREATE OR REPLACE TRIGGER Deal_Rejection_trg
    AFTER
    UPDATE
    ON DEALS
    FOR EACH ROW
BEGIN
   IF UPDATING THEN
   IF (:OLD.STATUS_ID = 1 AND :NEW.STATUS_ID = 2) THEN
   UPDATE DEALS SET STATUS_ID = 3 WHERE DEALS_ID != :NEW.DEALS_ID AND LISTING_ID = :NEW.LISTING_ID;
   END IF;
   END IF;
END;
/


CREATE OR REPLACE TRIGGER Order_Creation_trg
    AFTER
    INSERT OR UPDATE
    ON DEALS
    FOR EACH ROW
BEGIN
   IF INSERTING THEN
   IF (:NEW.STATUS_ID = 2) THEN
   INSERT INTO ORDER_STATUS(STATUS_ID,DEALS_ID) VALUES(1,:NEW.DEALS_ID);
   END IF;
   END IF;
   IF UPDATING THEN
   IF (:OLD.STATUS_ID = 1 AND :NEW.STATUS_ID = 2) THEN
   INSERT INTO ORDER_STATUS(STATUS_ID,DEALS_ID) VALUES(1,:NEW.DEALS_ID);
   END IF;
   END IF;
END;
/
